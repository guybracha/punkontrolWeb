# 🔒 הוראות אבטחה - מניעת עריכה לא מורשית

## ✅ מה תוקן

הוספנו **שכבת אבטחה כפולה** כדי למנוע ממשתמשים לערוך תוכן של משתמשים אחרים:

### 1. אבטחה בצד הלקוח (Frontend)
- **Artwork.jsx**: כפתור העריכה מוצג רק כאשר `userProfile.uid === art.authorId`
- **Post.jsx**: כפתור העריכה מוצג רק כאשר `userProfile.uid === post.authorId`

```javascript
const isOwner = userProfile && art && userProfile.uid === art.authorId;

// הכפתור מוצג רק אם isOwner === true
{isOwner && (
  <button onClick={handleEditClick}>✏️</button>
)}
```

### 2. אבטחה בצד השרת (Firestore Rules)
קובץ **firestore.rules** מגן על המסד נתונים ברמת Firebase.

**איך להעלות את הכללים:**
1. היכנס לקונסול Firebase: https://console.firebase.google.com
2. בחר את הפרויקט שלך (punkontrol)
3. לך ל-**Firestore Database** > **Rules**
4. העתק את התוכן מהקובץ `firestore.rules`
5. הדבק אותו בעורך הכללים
6. לחץ **Publish**

---

## 🛡️ מה הכללים מגינים עליו

### יצירות (Artworks)
- ✅ כולם יכולים לקרוא יצירות
- ✅ רק משתמשים מחוברים יכולים ליצור יצירות
- ✅ **רק היוצר יכול לערוך את היצירה שלו**
- ✅ **רק היוצר יכול למחוק את היצירה שלו**
- ❌ לא ניתן לשנות את שדה `authorId`

### פוסטים (Posts)
- ✅ כולם יכולים לקרוא פוסטים
- ✅ רק משתמשים מחוברים יכולים ליצור פוסטים
- ✅ **רק היוצר יכול לערוך את הפוסט שלו**
- ✅ **רק היוצר יכול למחוק את הפוסט שלו**
- ❌ לא ניתן לשנות את שדה `authorId`

### תגובות (Comments)
- ✅ כולם יכולים לקרוא תגובות
- ✅ רק משתמשים מחוברים יכולים להגיב
- ✅ **רק כותב התגובה יכול לערוך/למחוק אותה**

### משתמשים (Users)
- ✅ כולם יכולים לקרוא פרופילים
- ✅ **רק בעל החשבון יכול לערוך את הפרופיל שלו**

---

## 🧪 איך לבדוק שזה עובד

### בדיקה 1: נסה לערוך יצירה של מישהו אחר
1. התחבר כמשתמש A
2. גש ליצירה של משתמש B
3. **התוצאה:** כפתור העריכה לא יופיע בכלל

### בדיקה 2: נסה לערוך דרך Console (אם מישהו ינסה לעקוף)
1. פתח את Developer Console (F12)
2. נסה לשלוח בקשת עדכון ישירה ל-Firestore
3. **התוצאה:** Firestore יחזיר שגיאת הרשאה: `Permission denied`

### בדיקה 3: ערוך את התוכן שלך
1. התחבר כמשתמש A
2. גש ליצירה/פוסט שלך
3. **התוצאה:** כפתור העריכה יופיע ותוכל לערוך בהצלחה

---

## 📊 סטטוס הגנה

| רכיב | הגנת Frontend | הגנת Backend | סטטוס |
|------|--------------|--------------|-------|
| עריכת יצירות | ✅ | ✅ | 🔒 מוגן |
| עריכת פוסטים | ✅ | ✅ | 🔒 מוגן |
| עריכת תגובות | ✅ | ✅ | 🔒 מוגן |
| עריכת פרופיל | ✅ | ✅ | 🔒 מוגן |

---

## ⚠️ חשוב!

**חובה להעלות את קובץ firestore.rules לקונסול Firebase!**
בלי זה, ההגנה תהיה רק בצד הלקוח וניתן יהיה לעקוף אותה.

אחרי שתעלה את הכללים, המערכת תהיה מאובטחת לחלוטין.

---

## 🔍 דוגמה לניסיון עריכה לא מורשה

```
// משתמש B מנסה לערוך יצירה של משתמש A
// Frontend: כפתור העריכה לא יופיע
// Backend (אם ינסו לעקוף):

❌ Error: Missing or insufficient permissions.
   Code: permission-denied
   Message: false for 'update' @ L40
```

זה אומר ש-Firestore חסם את הבקשה כי הכללים דרשו:
- המשתמש המחובר = היוצר של היצירה
- הבדיקה נכשלה ← הבקשה נחסמה

---

**עודכן:** 8 בינואר 2026  
**אבטחה:** ✅ פעילה בשני רבדים
